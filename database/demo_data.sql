USE epms_final_db;

SET FOREIGN_KEY_CHECKS = 0; -- 临时关闭外键检查

-- ============================================================
-- 清理原有数据（按外键依赖顺序删除）
-- ============================================================

-- 删除有外键依赖的表（先删除子表）
TRUNCATE TABLE emp_training_relation;
TRUNCATE TABLE attendance;
TRUNCATE TABLE reward_punish;
TRUNCATE TABLE job_change;
TRUNCATE TABLE contract;
TRUNCATE TABLE attendance_monthly_summary;  -- 月度考勤汇总表
TRUNCATE TABLE salary_adjustment_log;      -- 工资调整历史表

-- 删除主表
TRUNCATE TABLE training_course;
TRUNCATE TABLE employee;
TRUNCATE TABLE position;
TRUNCATE TABLE department;
TRUNCATE TABLE sys_user;

-- 重置自增ID（可选，如果需要从1开始）
-- ALTER TABLE department AUTO_INCREMENT = 1;
-- ALTER TABLE position AUTO_INCREMENT = 1;
-- ALTER TABLE employee AUTO_INCREMENT = 1;
-- ALTER TABLE contract AUTO_INCREMENT = 1;
-- ALTER TABLE attendance AUTO_INCREMENT = 1;
-- ALTER TABLE reward_punish AUTO_INCREMENT = 1;
-- ALTER TABLE job_change AUTO_INCREMENT = 1;
-- ALTER TABLE training_course AUTO_INCREMENT = 1;
-- ALTER TABLE sys_user AUTO_INCREMENT = 1;

-- ============================================================
-- 1. 系统用户表 (sys_user)
-- ============================================================
INSERT INTO sys_user (username, password, role, related_emp_id) VALUES
('admin', 'admin123', 'ADMIN', NULL),
('hr001', 'hr123', 'HR', NULL),
('hr002', 'hr123', 'HR', NULL);

-- ============================================================
-- 2. 部门表 (department) - 5个部门
-- ============================================================
INSERT INTO department (dept_name, location) VALUES
('技术部', '计算机学院'),
('销售部', '慎思园'),
('人事部', 'GOGO新天地'),
('财务部', '学五饭堂'),
('市场部', '图书馆');

-- ============================================================
-- 3. 职位表 (position) - 10个职位，覆盖所有部门
-- ============================================================
INSERT INTO position (pos_name, base_salary, level) VALUES
-- 技术部职位
('初级工程师', 8000.00, 'P4'),
('中级工程师', 12000.00, 'P5'),
('高级工程师', 18000.00, 'P6'),
('技术总监', 25000.00, 'P7'),
-- 销售部职位
('销售专员', 6000.00, 'S1'),
('销售经理', 15000.00, 'S2'),
-- 人事部职位
('HR专员', 7000.00, 'HR1'),
('HR经理', 12000.00, 'HR2'),
-- 财务部职位
('财务专员', 8000.00, 'F1'),
('财务经理', 14000.00, 'F2'),
-- 市场部职位
('市场专员', 7000.00, 'M1'),
('市场经理', 13000.00, 'M2');

-- ============================================================
-- 4. 员工表 (employee) - 15名员工，覆盖所有状态和部门
-- ============================================================
INSERT INTO employee (dept_id, pos_id, name, gender, id_card, phone, politics_status, hukou_type, hire_date, status) VALUES
-- 技术部员工（5人）
(1, 3, '张三', '男', '110101199001011234', '13800138001', '群众', '城镇', '2021-01-15', '在职'),
(1, 2, '李四', '女', '110101199102022345', '13800138002', '团员', '城镇', '2022-03-20', '在职'),
(1, 1, '王五', '男', '110101199503033456', '13800138003', '群众', '农村', '2024-06-01', '试用期'),
(1, 4, '赵一', '男', '110101198801011111', '13800138011', '党员', '城镇', '2019-05-10', '在职'),
(1, 1, '钱二', '女', '110101199901022222', '13800138012', '团员', '城镇', '2025-10-01', '试用期'),

-- 销售部员工（4人）
(2, 6, '孙六', '男', '110101198804044567', '13800138004', '党员', '城镇', '2020-05-10', '在职'),
(2, 5, '周七', '女', '110101199605055678', '13800138005', '群众', '城镇', '2023-08-15', '在职'),
(2, 5, '吴八', '男', '110101199706066789', '13800138006', '团员', '城镇', '2024-11-01', '试用期'),
(2, 5, '郑九', '女', '110101199807077890', '13800138007', '群众', '农村', '2025-09-15', '试用期'),

-- 人事部员工（2人）
(3, 8, '王十', '女', '110101198507077890', '13800138008', '党员', '城镇', '2019-03-01', '在职'),
(3, 7, '李十一', '女', '110101199408088901', '13800138009', '群众', '城镇', '2022-07-20', '在职'),

-- 财务部员工（2人）
(4, 10, '张十二', '女', '110101198609099012', '13800138010', '党员', '城镇', '2020-01-10', '在职'),
(4, 9, '刘十三', '男', '110101199510100123', '13800138013', '群众', '城镇', '2023-04-15', '在职'),

-- 市场部员工（2人）
(5, 12, '陈十四', '男', '110101199011111234', '13800138014', '团员', '城镇', '2022-02-20', '在职'),
(5, 11, '杨十五', '女', '110101199512122345', '13800138015', '群众', '城镇', '2024-08-01', '试用期');

-- ============================================================
-- 5. 合同表 (contract) - 覆盖所有类型和状态，包含即将到期合同
-- ============================================================
INSERT INTO contract (emp_id, type, start_date, end_date, status) VALUES
-- 即将到期的合同（重点展示）- 距离今天(2025-12-06)在30天内到期
(1, '固定期限', '2021-01-15', '2025-12-15', '有效'),  -- 9天后到期 - 紧急
(2, '固定期限', '2022-03-20', '2025-12-25', '有效'),  -- 19天后到期 - 重要
(12, '固定期限', '2020-01-10', '2026-01-05', '有效'),  -- 30天后到期 - 一般
(7, '固定期限', '2023-08-15', '2026-01-10', '有效'),  -- 35天后到期 - 即将

-- 有效合同（较长时间到期）
(4, '固定期限', '2019-05-10', '2026-05-09', '有效'),
(6, '固定期限', '2020-05-10', '2026-05-09', '有效'),
(10, '固定期限', '2019-03-01', '2027-03-01', '有效'),
(11, '固定期限', '2022-07-20', '2025-07-19', '有效'),
(13, '固定期限', '2023-04-15', '2026-04-14', '有效'),
(14, '固定期限', '2022-02-20', '2027-02-19', '有效'),

-- 无固定期限合同
(4, '无固定期限', '2019-05-10', NULL, '有效'),  -- 技术总监
(10, '无固定期限', '2019-03-01', NULL, '有效'),  -- HR经理
(12, '无固定期限', '2020-01-10', NULL, '有效'),  -- 财务经理

-- 实习合同（试用期员工）
(3, '实习', '2024-06-01', '2025-12-31', '有效'),
(5, '实习', '2025-10-01', '2026-04-30', '有效'),
(8, '实习', '2024-11-01', '2026-01-15', '有效'),
(9, '实习', '2025-09-15', '2026-03-15', '有效'),
(15, '实习', '2024-08-01', '2025-12-31', '有效'),

-- 过期合同（用于测试合同预警视图）
(11, '固定期限', '2022-07-20', '2025-07-19', '过期'),  -- 已过期
(7, '固定期限', '2023-08-15', '2025-08-14', '过期');  -- 已过期

-- ============================================================
-- 6. 考勤表 (attendance) - 覆盖所有类型，最近2个月数据
-- ============================================================
-- 2025年11月数据
INSERT INTO attendance (emp_id, work_date, type, hours, remarks) VALUES
-- 11月正常考勤
(1, '2025-11-01', '正常', 8.0, NULL),
(1, '2025-11-04', '正常', 8.0, NULL),
(1, '2025-11-05', '迟到', 7.5, '迟到30分钟'),
(1, '2025-11-06', '正常', 8.0, NULL),
(1, '2025-11-07', '正常', 8.0, NULL),
(1, '2025-11-08', '正常', 8.0, NULL),
(1, '2025-11-11', '正常', 8.0, NULL),
(1, '2025-11-12', '正常', 8.0, NULL),
(1, '2025-11-13', '正常', 8.0, NULL),
(1, '2025-11-14', '正常', 8.0, NULL),
(1, '2025-11-15', '正常', 8.0, NULL),
(1, '2025-11-18', '正常', 8.0, NULL),
(1, '2025-11-19', '正常', 8.0, NULL),
(1, '2025-11-20', '正常', 8.0, NULL),
(1, '2025-11-21', '正常', 8.0, NULL),
(1, '2025-11-22', '正常', 8.0, NULL),
(1, '2025-11-25', '正常', 8.0, NULL),
(1, '2025-11-26', '正常', 8.0, NULL),
(1, '2025-11-27', '正常', 8.0, NULL),
(1, '2025-11-28', '正常', 8.0, NULL),
(1, '2025-11-29', '正常', 8.0, NULL),

-- 11月其他类型考勤
(2, '2025-11-01', '正常', 8.0, NULL),
(2, '2025-11-04', '正常', 8.0, NULL),
(2, '2025-11-05', '正常', 8.0, NULL),
(2, '2025-11-06', '正常', 8.0, NULL),
(2, '2025-11-07', '请假', 0.0, '病假'),
(2, '2025-11-08', '正常', 8.0, NULL),
(2, '2025-11-11', '正常', 8.0, NULL),
(2, '2025-11-12', '正常', 8.0, NULL),
(2, '2025-11-13', '正常', 8.0, NULL),
(2, '2025-11-14', '正常', 8.0, NULL),
(2, '2025-11-15', '正常', 8.0, NULL),
(2, '2025-11-18', '正常', 8.0, NULL),
(2, '2025-11-19', '正常', 8.0, NULL),
(2, '2025-11-20', '正常', 8.0, NULL),
(2, '2025-11-21', '正常', 8.0, NULL),
(2, '2025-11-22', '正常', 8.0, NULL),
(2, '2025-11-25', '正常', 8.0, NULL),
(2, '2025-11-26', '正常', 8.0, NULL),
(2, '2025-11-27', '正常', 8.0, NULL),
(2, '2025-11-28', '正常', 8.0, NULL),
(2, '2025-11-29', '正常', 8.0, NULL),

(3, '2025-11-01', '正常', 8.0, NULL),
(3, '2025-11-04', '正常', 8.0, NULL),
(3, '2025-11-05', '正常', 8.0, NULL),
(3, '2025-11-06', '正常', 8.0, NULL),
(3, '2025-11-07', '正常', 8.0, NULL),
(3, '2025-11-08', '正常', 8.0, NULL),
(3, '2025-11-11', '正常', 8.0, NULL),
(3, '2025-11-12', '早退', 7.0, '早退1小时'),
(3, '2025-11-13', '正常', 8.0, NULL),
(3, '2025-11-14', '正常', 8.0, NULL),
(3, '2025-11-15', '正常', 8.0, NULL),
(3, '2025-11-18', '正常', 8.0, NULL),
(3, '2025-11-19', '正常', 8.0, NULL),
(3, '2025-11-20', '正常', 8.0, NULL),
(3, '2025-11-21', '正常', 8.0, NULL),
(3, '2025-11-22', '正常', 8.0, NULL),
(3, '2025-11-25', '正常', 8.0, NULL),
(3, '2025-11-26', '正常', 8.0, NULL),
(3, '2025-11-27', '正常', 8.0, NULL),
(3, '2025-11-28', '正常', 8.0, NULL),
(3, '2025-11-29', '正常', 8.0, NULL),

-- 12月数据（当前月）
(1, '2025-12-01', '正常', 8.0, NULL),
(1, '2025-12-02', '正常', 8.0, NULL),
(1, '2025-12-03', '迟到', 7.5, '迟到30分钟'),
(1, '2025-12-04', '正常', 8.0, NULL),
(1, '2025-12-05', '正常', 8.0, NULL),
(1, '2025-12-06', '正常', 8.0, NULL),

(2, '2025-12-01', '正常', 8.0, NULL),
(2, '2025-12-02', '正常', 8.0, NULL),
(2, '2025-12-03', '正常', 8.0, NULL),
(2, '2025-12-04', '请假', 0.0, '病假'),
(2, '2025-12-05', '正常', 8.0, NULL),
(2, '2025-12-06', '正常', 8.0, NULL),

(3, '2025-12-01', '正常', 8.0, NULL),
(3, '2025-12-02', '早退', 7.0, '早退1小时'),
(3, '2025-12-03', '正常', 8.0, NULL),
(3, '2025-12-04', '正常', 8.0, NULL),
(3, '2025-12-05', '出差', 8.0, '客户拜访'),
(3, '2025-12-06', '正常', 8.0, NULL),

-- 其他员工的部分考勤记录
(4, '2025-12-01', '正常', 8.0, NULL),
(4, '2025-12-02', '正常', 8.0, NULL),
(4, '2025-12-03', '正常', 8.0, NULL),
(4, '2025-12-04', '正常', 8.0, NULL),
(4, '2025-12-05', '正常', 8.0, NULL),

(6, '2025-12-01', '正常', 8.0, NULL),
(6, '2025-12-02', '正常', 8.0, NULL),
(6, '2025-12-03', '正常', 8.0, NULL),
(6, '2025-12-04', '正常', 8.0, NULL),
(6, '2025-12-05', '正常', 8.0, NULL),

(7, '2025-12-01', '正常', 8.0, NULL),
(7, '2025-12-02', '正常', 8.0, NULL),
(7, '2025-12-03', '正常', 8.0, NULL),
(7, '2025-12-04', '正常', 8.0, NULL),
(7, '2025-12-05', '正常', 8.0, NULL),

-- 异常考勤示例
(8, '2025-12-01', '迟到', 7.5, '迟到30分钟'),
(8, '2025-12-02', '正常', 8.0, NULL),
(8, '2025-12-03', '旷工', 0.0, '未到岗'),
(8, '2025-12-04', '正常', 8.0, NULL),
(8, '2025-12-05', '正常', 8.0, NULL);

-- ============================================================
-- 7. 奖惩表 (reward_punish) - 覆盖奖励和惩罚
-- ============================================================
INSERT INTO reward_punish (emp_id, type, amount, event_date, reason) VALUES
-- 奖励记录
(1, '奖励', 1000.00, '2025-11-15', '优秀员工奖'),
(1, '奖励', 500.00, '2025-12-01', '月度绩效优秀'),
(2, '奖励', 500.00, '2025-11-20', '项目完成奖励'),
(2, '奖励', 300.00, '2025-12-03', '技术创新奖'),
(4, '奖励', 2000.00, '2025-11-30', '技术突破奖'),
(4, '奖励', 1500.00, '2025-12-05', '团队领导奖'),
(6, '奖励', 2000.00, '2025-11-25', '销售冠军'),
(6, '奖励', 1000.00, '2025-12-01', '月度销售第一'),
(7, '奖励', 800.00, '2025-11-25', '完成季度目标'),
(7, '奖励', 600.00, '2025-12-04', '客户满意度高'),
(10, '奖励', 1200.00, '2025-11-28', 'HR工作优秀'),
(12, '奖励', 1000.00, '2025-12-01', '财务工作突出'),

-- 惩罚记录
(3, '惩罚', -200.00, '2025-12-03', '迟到扣款'),
(3, '惩罚', -100.00, '2025-12-02', '早退扣款'),
(8, '惩罚', -500.00, '2025-12-03', '旷工扣款'),
(8, '惩罚', -200.00, '2025-12-01', '迟到扣款'),
(9, '惩罚', -300.00, '2025-12-05', '工作失误扣款'),
(15, '惩罚', -150.00, '2025-11-28', '迟到扣款');

-- ============================================================
-- 8. 培训课程表 (training_course) - 5个课程
-- ============================================================
INSERT INTO training_course (course_name, start_time, end_time, location, trainer) VALUES
('Spring Boot 实战开发', '2025-12-10 09:00:00', '2025-12-10 17:00:00', '培训室A', '张讲师'),
('销售技巧提升训练', '2025-12-15 14:00:00', '2025-12-15 18:00:00', '培训室B', '李讲师'),
('HR管理实务培训', '2025-12-20 09:00:00', '2025-12-20 17:00:00', '培训室C', '王讲师'),
('财务制度与规范', '2025-12-25 09:00:00', '2025-12-25 12:00:00', '培训室D', '赵讲师'),
('团队协作与沟通', '2025-12-28 14:00:00', '2025-12-28 17:00:00', '培训室A', '周讲师');

-- ============================================================
-- 9. 培训记录表 (emp_training_relation) - 覆盖不同状态
-- ============================================================
INSERT INTO emp_training_relation (emp_id, course_id, score, is_completed) VALUES
-- 已完成培训（成绩>=60）
(1, 1, 85.00, TRUE),   -- 技术部员工参加技术培训
(2, 1, 90.00, TRUE),
(3, 1, 65.00, TRUE),   -- 刚好及格，触发自动完成
(4, 1, 92.00, TRUE),
(5, 1, 78.00, TRUE),

-- 销售部员工参加销售培训
(6, 2, 88.00, TRUE),
(7, 2, 82.00, TRUE),
(8, 2, 75.00, TRUE),
(9, 2, 60.00, TRUE),   -- 刚好及格

-- 人事部员工参加HR培训
(10, 3, 95.00, TRUE),
(11, 3, 88.00, TRUE),

-- 财务部员工参加财务培训
(12, 4, 90.00, TRUE),
(13, 4, 85.00, TRUE),

-- 未完成培训（成绩<60或未评分）
-- 注意：由于主键约束，同一员工不能对同一课程有多条记录
-- 以下员工参加其他课程或未完成培训
(8, 3, NULL, FALSE),   -- 员工8参加HR培训但未评分
(9, 3, 45.00, FALSE),  -- 员工9参加HR培训但成绩不及格
(15, 5, NULL, FALSE),  -- 员工15未参加或未评分

-- 跨部门培训
(1, 5, 88.00, TRUE),   -- 技术部参加团队协作培训
(6, 5, 85.00, TRUE),   -- 销售部参加团队协作培训
(10, 5, 90.00, TRUE);  -- 人事部参加团队协作培训

-- ============================================================
-- 10. 人事变动表 (job_change) - 部分手动插入，部分由触发器自动生成
-- 注意：触发器会自动记录入职、转正、调动、晋升、离职
-- 这里手动插入一些历史记录，展示完整功能
-- ============================================================
-- 注意：大部分记录会由触发器自动生成，这里只插入一些特殊的历史记录
INSERT INTO job_change (emp_id, change_type, old_dept_name, new_dept_name, old_pos_name, new_pos_name, change_date, remarks) VALUES
(4, '晋升', '技术部', '技术部', '高级工程师', '技术总监', '2024-01-15 10:00:00', '晋升为技术总监'),
(6, '调动', '技术部', '销售部', '中级工程师', '销售经理', '2023-06-01 09:00:00', '从技术部调动到销售部'),
(10, '晋升', '人事部', '人事部', 'HR专员', 'HR经理', '2021-05-01 09:00:00', '晋升为HR经理'),
(12, '晋升', '财务部', '财务部', '财务专员', '财务经理', '2022-01-10 09:00:00', '晋升为财务经理');

-- ============================================================
-- 11. 更新系统用户关联员工
-- ============================================================
-- 将部分系统用户关联到员工
UPDATE sys_user SET related_emp_id = 10 WHERE username = 'hr001';
UPDATE sys_user SET related_emp_id = 11 WHERE username = 'hr002';

-- ============================================================
-- 数据插入完成，恢复外键检查
-- ============================================================
SET FOREIGN_KEY_CHECKS = 1;

-- ============================================================
-- 数据统计查询
-- ============================================================
SELECT '=== 数据插入完成统计 ===' AS message;
SELECT CONCAT('部门数量: ', COUNT(*)) AS info FROM department;
SELECT CONCAT('职位数量: ', COUNT(*)) AS info FROM position;
SELECT CONCAT('员工总数: ', COUNT(*)) AS info FROM employee;
SELECT CONCAT('  - 在职: ', COUNT(*)) AS info FROM employee WHERE status = '在职';
SELECT CONCAT('  - 试用期: ', COUNT(*)) AS info FROM employee WHERE status = '试用期';
SELECT CONCAT('  - 离职: ', COUNT(*)) AS info FROM employee WHERE status = '离职';
SELECT CONCAT('合同数量: ', COUNT(*)) AS info FROM contract;
SELECT CONCAT('  - 有效: ', COUNT(*)) AS info FROM contract WHERE status = '有效';
SELECT CONCAT('  - 过期: ', COUNT(*)) AS info FROM contract WHERE status = '过期';
SELECT CONCAT('考勤记录: ', COUNT(*)) AS info FROM attendance;
SELECT CONCAT('奖惩记录: ', COUNT(*)) AS info FROM reward_punish;
SELECT CONCAT('  - 奖励: ', COUNT(*)) AS info FROM reward_punish WHERE type = '奖励';
SELECT CONCAT('  - 惩罚: ', COUNT(*)) AS info FROM reward_punish WHERE type = '惩罚';
SELECT CONCAT('培训课程: ', COUNT(*)) AS info FROM training_course;
SELECT CONCAT('培训记录: ', COUNT(*)) AS info FROM emp_training_relation;
SELECT CONCAT('  - 已完成: ', COUNT(*)) AS info FROM emp_training_relation WHERE is_completed = TRUE;
SELECT CONCAT('  - 未完成: ', COUNT(*)) AS info FROM emp_training_relation WHERE is_completed = FALSE;
SELECT CONCAT('人事变动: ', COUNT(*)) AS info FROM job_change;
SELECT CONCAT('系统用户: ', COUNT(*)) AS info FROM sys_user;

SELECT '=== 演示数据生成完成！===' AS message;

